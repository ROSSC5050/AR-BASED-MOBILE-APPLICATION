using UnityEngine;
using UnityEngine.UI;
using System.Collections;
using System.Net.Http;
using System.Threading.Tasks;

public class InputFieldWriter : MonoBehaviour
{
    // Replace YOUR_AUTH_TOKEN with your Blynk API auth token
    public string authToken = "YOUR_AUTH_TOKEN";

    // Replace YOUR_PIN with the virtual pin number to read from
    public string pinNumber = "YOUR_PIN";

    // Reference to the InputField UI element
    public InputField inputField;

    // The delay (in seconds) between Blynk API requests
    public float requestDelay = 1f;

    private async void Start()
    {
        while (true)
        {
            string apiUrl = $"http://blynk-cloud.com/{authToken}/get/{pinNumber}";

            using (var httpClient = new HttpClient())
            {
                var response = await httpClient.GetAsync(apiUrl);

                if (response.IsSuccessStatusCode)
                {
                    var responseContent = await response.Content.ReadAsStringAsync();
                    inputField.text = responseContent;
                }
                else
                {
                    Debug.LogError($"Failed to read value from pin {pinNumber}. Status code: {response.StatusCode}");
                }
            }

            // Wait for the specified delay before making the next API request
            await Task.Delay((int)(requestDelay * 1000));
        }
    }
}
